<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .delete-btn {
            background-color: #dc3545;
            color: #fff;
            padding: 10px;
            border: none;
            cursor: pointer;
        }

        .selected-row {
            background-color: #f8f9fa !important;
        }

        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pagination-btn {
            background-color: #007bff;
            color: #fff;
            margin: 0 5px;
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }

        .pagination-btn:hover {
            background-color: #0056b3;
        }

        .edit-btn, .save-btn, .cancel-btn {
            background-color: #28a745;
            color: #fff;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }

        .edit-btn {
            background-color: #007bff;
        }

        .select-all-checkbox {
            margin-right: 10px;
        }
    </style>
</head>
<body>

<!-- Search Bar Section -->
<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Enter Value..." />
    <button class="search-icon" onclick="search()">Search</button>
</div>

<!-- User Table Section -->
<table id="userTable">
    <thead>
        <tr>
            <th>
                <input type="checkbox" class="select-all-checkbox" onclick="selectAllRows()" />
            </th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Pagination Section -->
<div class="pagination" id="pagination">
</div>

<!-- Delete Selected Button -->
<div>
    <button onclick="deleteSelected()" class="delete-btn">Delete Selected</button>
</div>

<!-- JavaScript Section -->
<script>
    let users = []; // Array to store fetched users
    let selectedRows = []; // Array to store selected row IDs
    let editedRowId = null;
    let currentPage = 1;
    const rowsPerPage = 10;

    // Fetch users from the provided API endpoint
    async function fetchUsers() {
        const response = await fetch('https://geektrust.s3-ap-southeast-1.amazonaws.com/adminui-problem/members.json');
        users = await response.json();
        renderTable(users);
        renderPagination();
    }

    // Render the table with users
    function renderTable(data) {
        const tableBody = document.querySelector('#userTable tbody');
        tableBody.innerHTML = '';

        // Calculate the range of displayed users based on the current page
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;
        const displayedUsers = data.slice(startIndex, endIndex);

        displayedUsers.forEach(user => {
            const row = tableBody.insertRow();

            // Populate table cells
            Object.entries(user).forEach(([key, value], index) => {
                const cell = row.insertCell();
                if (editedRowId === user.id && key !== 'id') {
                    // Display input field for editing
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = value;
                    cell.appendChild(input);
                } else {
                    if (key === 'id') {
                        // Add checkbox for row selection
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.value = user.id;
                        checkbox.checked = selectedRows.includes(user.id);
                        checkbox.addEventListener('change', () => selectRow(row, user.id));
                        cell.appendChild(checkbox);
                    } else {
                        cell.textContent = value;
                    }
                }
            });

            // Add edit, save, and cancel buttons
            const actionsCell = row.insertCell();
            if (editedRowId === user.id) {
                actionsCell.innerHTML = `<button onclick="saveRow(${user.id})" class="save-btn">Save</button>`;
                actionsCell.innerHTML += `<button onclick="cancelEdit(${user.id})" class="cancel-btn">Cancel</button>`;
            } else {
                actionsCell.innerHTML = `<button onclick="editRow(${user.id})" class="edit-btn">Edit</button>`;
                actionsCell.innerHTML += `<button onclick="deleteRow(${user.id})" class="delete-btn">Delete</button>`;
            }

            // Add event listener to handle row selection
            row.addEventListener('click', () => selectRow(row, user.id));
        });
    }

    // Render pagination buttons
    function renderPagination() {
        const totalPages = Math.ceil(users.length / rowsPerPage);
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = '';

        // Generate pagination buttons
        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.classList.add('pagination-btn');
            btn.textContent = i;
            btn.addEventListener('click', () => goToPage(i));
            paginationContainer.appendChild(btn);
        }
    }

    // Function to handle pagination
    function goToPage(page) {
        currentPage = page;
        renderTable(users);
    }

    // Function to search users based on input
    function search() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const filteredUsers = users.filter(user =>
            Object.values(user).some(value => value.toLowerCase().includes(searchInput))
        );
        currentPage = 1;
        renderTable(filteredUsers);
        renderPagination();
    }

    // Function to select/deselect a row
    function selectRow(row, userId) {
        const checkbox = row.querySelector('input[type="checkbox"]');
        if (editedRowId !== userId) {
            if (selectedRows.includes(userId)) {
                selectedRows = selectedRows.filter(id => id !== userId);
                row.classList.remove('selected-row');
            } else {
                selectedRows.push(userId);
                row.classList.add('selected-row');
            }
        }
        checkbox.checked = selectedRows.includes(userId);
    }

    // Function to select or deselect all displayed rows
    function selectAllRows() {
        const checkboxes = document.querySelectorAll('#userTable tbody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            const row = checkbox.closest('tr');
            const userId = parseInt(checkbox.value);
            if (!editedRowId) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked && !selectedRows.includes(userId)) {
                    selectedRows.push(userId);
                    row.classList.add('selected-row');
                } else if (!checkbox.checked && selectedRows.includes(userId)) {
                    selectedRows = selectedRows.filter(id => id !== userId);
                    row.classList.remove('selected-row');
                }
            }
        });
    }

    // Function to delete selected rows
    function deleteSelected() {
        users = users.filter(user => !selectedRows.includes(user.id));
        renderTable(users);
        renderPagination();
        selectedRows = [];
    }

    // Function to edit a row
    function editRow(userId) {
        editedRowId = userId;
        renderTable(users);
    }

    // Function to save edited row
    function saveRow(userId) {
        editedRowId = null;
        renderTable(users);
    }

    // Function to cancel editing
    function cancelEdit(userId) {
        editedRowId = null;
        renderTable(users);
    }

    // Initialize the dashboard
    fetchUsers();
</script>

</body>
</html>
