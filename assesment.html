<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .cancel-btn,.delete-btn {
            background-color: #dc3545;
            color: #fff;
            padding: 10px;
            border: none;
            cursor: pointer;
        }

        .selected-row {
            background-color: #f8f9fa !important;
        }

        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pagination-btn {
            background-color: #007bff;
            color: #fff;
            margin: 0 5px;
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }

        .pagination-btn:hover {
            background-color: #0056b3;
        }

        .edit-btn, .save-btn {
            background-color: #28a745;
            color: #fff;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }

        .edit-btn {
            background-color: #007bff;
        }

        .select-all-checkbox {
            margin-right: 10px;
        }
      
        /* Styles for blurring other rows */
        .blur-row {
            filter: blur(3px);
        }

        /* Styles for enlarging the clicked row */
        .enlarge-row {
            transform: scale(1.1);
            font-weight: bold;
            transition: transform 0.5s ease, font-weight 0.5s ease;
        }

        /* Styles for transition effects */
        .save-transition {
            transition: transform 5s ease, font-weight 5s ease, opacity 5s ease, background-color 5s ease, color 5s ease, padding 5s ease;
        }

        /* Styles for reverse transition on Save button */
        .reverse-save-transition {
            transition: transform 0.5s ease, font-weight 0.5s ease, opacity 0.5s ease, background-color 0.5s ease, color 0.5s ease, padding 0.5s ease;
        }

    </style>
</head>
<body>

<!-- Search Bar Section -->
<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Enter Value..." />
    <button class="search-icon" onclick="search()">Search</button>
</div>

<!-- User Table Section -->
<table id="userTable">
    <thead>
        <tr>
            <th>
                <input type="checkbox" class="select-all-checkbox" onclick="selectAllRows()" />
            </th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Pagination Section -->
<div class="pagination" id="pagination"></div>

<!-- Delete Selected Button -->
<div>
    <button onclick="deleteSelected()" class="delete-btn">Delete Selected</button>
</div>

<!-- JavaScript Section -->
<script>
    let users = []; // Array to store fetched users
    let selectedRows = []; // Array to store selected row IDs
    let editedRowId = null;
    let currentPage = 1;
    const rowsPerPage = 10;

    // Fetch users from the provided API endpoint
    async function fetchUsers() {
        const response = await fetch('https://geektrust.s3-ap-southeast-1.amazonaws.com/adminui-problem/members.json');
        users = await response.json();
        renderTable(users);
        renderPagination();
    }

    // Render the table with users
    function renderTable(data) {
        const tableBody = document.querySelector('#userTable tbody');
        tableBody.innerHTML = '';

        // Calculate the range of displayed users based on the current page
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;
        const displayedUsers = data.slice(startIndex, endIndex);

        displayedUsers.forEach(user => {
            const row = tableBody.insertRow();

            // Populate table cells
            Object.entries(user).forEach(([key, value], index) => {
                const cell = row.insertCell();
                if (editedRowId === user.id && key !== 'id') {
                    // Display input field for editing
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = value;
                    cell.appendChild(input);
                } else {
                    if (index === 0) { // Check if it's the first column
                        // Add checkbox for row selection to the first column
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.value = user.id;
                        cell.appendChild(checkbox);
                    } else {
                        cell.textContent = value;
                    }
                }
            });

            // Add edit, save, and cancel buttons
            const actionsCell = row.insertCell();
            actionsCell.innerHTML = `<button onclick="editRow(this)" class="edit-btn">Edit</button>`;
            actionsCell.innerHTML += `<button onclick="deleteRow(this)" class="delete-btn">Delete</button>`;
            actionsCell.innerHTML += `<button onclick="saveRow(this)" class="save-btn" style="display: none;">Save</button>`;
            actionsCell.innerHTML += `<button onclick="cancelEditRow(this)" class="cancel-btn" style="display: none;">Cancel</button>`;

            // Add event listener to handle row selection
            row.addEventListener('click', () => selectRow(row, user.id));
        });
    }

    // Function to delete a row
    function deleteRow(button) {
        // Get the reference to the button's parent row
        var row = button.parentNode.parentNode;
        // Remove the row from the table
        row.parentNode.removeChild(row);
    }

    // Render pagination buttons
    function renderPagination() {
        const totalPages = Math.ceil(users.length / rowsPerPage);
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = '';

        // Generate pagination buttons
        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.classList.add('pagination-btn');
            btn.textContent = i;
            btn.addEventListener('click', () => goToPage(i));
            paginationContainer.appendChild(btn);
        }
    }

    // Function to handle pagination
    function goToPage(page) {
        currentPage = page;
        renderTable(users);
    }

    // Function to search users based on input
    function search() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const filteredUsers = users.filter(user =>
            Object.values(user).some(value => value.toLowerCase().includes(searchInput))
        );
        currentPage = 1;
        renderTable(filteredUsers);
        renderPagination();
    }

    // Function to select/deselect a row
    function selectRow(row, userId) {
        const checkbox = row.querySelector('input[type="checkbox"]');
        if (editedRowId !== userId) {
            if (selectedRows.includes(userId)) {
                selectedRows = selectedRows.filter(id => id !== userId);
                row.classList.remove('selected-row');
            } else {
                selectedRows.push(userId);
                row.classList.add('selected-row');
            }
        }
        if (checkbox) {
            checkbox.checked = selectedRows.includes(userId);
        }
    }

    // Function to select or deselect all displayed rows
    function selectAllRows() {
        const checkboxes = document.querySelectorAll('#userTable tbody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            const row = checkbox.closest('tr');
            const userId = parseInt(checkbox.value);
            if (!editedRowId) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked && !selectedRows.includes(userId)) {
                    selectedRows.push(userId);
                    row.classList.add('selected-row');
                } else if (!checkbox.checked && selectedRows.includes(userId)) {
                    selectedRows = selectedRows.filter(id => id !== userId);
                    row.classList.remove('selected-row');
                }
            }
        });
    }

    // Function to delete selected rows
    function deleteSelected() {
        users = users.filter(user => !selectedRows.includes(user.id));
        renderTable(users);
        renderPagination();
        selectedRows = [];
    }

    // Function to edit a row
function editRow(button) {
    var row = button.closest('tr');
    var cells = row.getElementsByTagName("td");

    // Store the original values in data attributes
    for (var i = 0; i < cells.length - 1; i++) {
        cells[i].setAttribute("data-original-value", cells[i].innerText);
    }

    // Change the cell content to input fields for editing (only for Name, Email, and Role)
    for (var i = 1; i <= 3; i++) {
        cells[i].innerHTML = '<input type="text" value="' + cells[i].innerText + '">';
    }

    // Toggle button visibility
    toggleButtonVisibility(row, true);

    // Hide the "Delete" button
    var deleteButton = row.querySelector('.delete-btn');
    if (deleteButton) {
        deleteButton.style.display = 'none';
    }

    // Apply styles to blur other rows and enlarge the clicked row
    applyStylesOnEdit(row);

   // Delay the application of the border after the transition
   setTimeout(function () {
        // Apply border to the selected row after delay
        row.style.border = '2px solid #28a745';
        row.style.borderRadius = '50px';
    }, 100); // Adjust the delay to match the transition duration
}


    // Function to apply styles on editing
    function applyStylesOnEdit(row) {
        // Blur other rows
        const tableRows = document.querySelectorAll('#userTable tbody tr');
        tableRows.forEach((otherRow) => {
            if (otherRow !== row) {
                otherRow.classList.add('blur-row');
            }
        });

        // Enlarge the clicked row
        row.classList.add('enlarge-row');
    }

    // Function to save edited row
    function saveRow(button) {
    var row = button.parentNode.parentNode;
    var cells = row.getElementsByTagName("td");

    // Apply the transition class for saving
    row.classList.add('save-transition');

    // Toggle the transition class on the Save button
    var saveBtn = row.querySelector('.save-btn');
    if (saveBtn) {
        saveBtn.classList.add('reverse-save-transition');
    }

    // Apply border to the selected row
    row.style.border = '2px solid #28a745';

    // Listen for the transition end event
    row.addEventListener('transitionend', function () {
        // Change the cell content back to the original values
        for (var i = 0; i < cells.length - 1; i++) {
            if (i === 0) {
                // For the first cell (Checkbox column), recreate the checkbox
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = cells[i].getElementsByTagName("input")[0].value;
                cells[i].innerHTML = '';
                cells[i].appendChild(checkbox);
            } else {
                // For other cells, set the value from the input field
                cells[i].innerText = cells[i].getElementsByTagName("input")[0].value;
            }
        }

        // Toggle button visibility
        toggleButtonVisibility(row, false);

        // Show the "Delete" button
        var deleteButton = row.querySelector('.delete-btn');
        if (deleteButton) {
            deleteButton.style.display = 'inline-block';
        }

        // Remove styles applied during editing
        removeStylesAfterEdit(row);

        // Remove the transition class on the Save button
        if (saveBtn) {
            saveBtn.classList.remove('reverse-save-transition');
        }

        // Remove the transition class for saving after the transition is complete
        row.classList.remove('save-transition');
        row.style.border = 'none';
    }, { once: true });
}

    // Function to remove styles applied during editing
    function removeStylesAfterEdit(row) {
        // Remove blur from other rows
        const tableRows = document.querySelectorAll('#userTable tbody tr');
        tableRows.forEach((otherRow) => {
            if (otherRow !== row) {
                otherRow.classList.remove('blur-row');
            }
        });

        // Remove enlargement from the clicked row
        row.classList.remove('enlarge-row');
    }

    function toggleButtonVisibility(row, editing) {
        var editBtn = row.querySelector('.edit-btn');
        var saveBtn = row.querySelector('.save-btn');
        var cancelBtn = row.querySelector('.cancel-btn');
        var deleteBtn = row.querySelector('.delete-btn');

        if (editBtn) {
            editBtn.style.display = editing ? 'none' : 'inline-block';
        }

        if (saveBtn) {
            saveBtn.style.display = editing ? 'inline-block' : 'none';
        }

        if (cancelBtn) {
            cancelBtn.style.display = editing ? 'inline-block' : 'none';
        }

        if (deleteBtn) {
            deleteBtn.style.display = editing ? 'none' : 'inline-block';
        }
    }

    // Initialize the dashboard
    fetchUsers();
</script>

</body>
</html>
